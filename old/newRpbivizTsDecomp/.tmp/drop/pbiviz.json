{"visual":{"name":"PowerBI-visuals-template","displayName":"Template","guid":"PBI_CV_Template","visualClassName":"Visual","version":"1.0.0","description":"<span>Some description <br/><br/><span style='font-style:italic'>Service prerequisites:</span> R-powered custom visual is used in service seamlessly<br/><br /><span style='font-style:italic'>Desktop prerequisites:</span> To run R scripts in Power BI Desktop, you must separately install R on your local computer.<br />You can download and install R for free from the <a href='https://mran.revolutionanalytics.com/download/'>Revolution Open download page</a> or the <a href='https://cran.r-project.org/bin/windows/base/'>CRAN Repository</a><br /><br /> <span style='font-style:italic'> R package dependencies(auto-installed): </span> some packages <br /><br /> <span style='font-style:italic'> Supports R versions: </span> R 3.3.1, R 3.3.0, MRO 3.3.1, MRO 3.3.0 <br /></span>","supportUrl":"http://community.powerbi.com/","gitHubUrl":""},"apiVersion":"1.3.0","author":{"name":"","email":""},"assets":{"icon":"assets/icon.png"},"externalJS":[],"style":"style/visual.less","capabilities":{"dataRoles":[{"displayName":"Time","description":"Time column","kind":"Grouping","name":"Time"},{"displayName":"Value","description":"Numeric","kind":"Measure","name":"Value"}],"dataViewMappings":[{"conditions":[{"Time":{"max":1},"Value":{"max":1}}],"scriptResult":{"dataInput":{"table":{"rows":{"select":[{"for":{"in":"Time"}},{"for":{"in":"Value"}}],"dataReductionAlgorithm":{"top":{}}}}},"script":{"scriptProviderDefault":"R","scriptOutputType":"png","source":{"objectName":"rcv_script","propertyName":"source"},"provider":{"objectName":"rcv_script","propertyName":"provider"},"scriptSourceDefault":"set.seed(42)\r\n\r\nTime = seq(1999,2012, by = 0.25) \r\nValue = data.frame( v = rep(c(1,2,3,4), length.out = length(Time)) + runif(length(Time), min=0, max=3))\r\n\r\n#drawWhat: clean, trend, seasonal, all, energy, seasonalyAdjasted\r\n\r\n#********* PBI Parameters Block ***************\r\nif(!exists(\"Time\"))\r\n\tTime = NULL \r\n\r\nif(!exists(\"Value\"))\r\n\tValue = NULL \r\n\r\nif(exists(\"settings_tsdecomp_params_show\") && settings_tsdecomp_params_show == FALSE)\r\n\trm(list= ls(pattern = \"settings_tsdecomp_params_\" ))\r\n\r\nif(exists(\"settings_demo_params_show\") && settings_demo_params_show == FALSE)\r\n\trm(list= ls(pattern = \"settings_demo_params_\" ))\r\n\r\n##PBI_PARAM: display_name: frequency, tooltip:frequency\r\n# Type: numeric, default:12, \r\n# Min: 2, Max:10000\r\nfreq = 12  #default\r\nif (exists(\"settings_tsdecomp_params_freq\")) \r\n{\r\n\tfreq = settings_tsdecomp_params_freq\r\n\tfreq = max( min (freq, 10000), 2)\r\n}\r\n\r\n##PBI_PARAM: display_name: degree, tooltip:degree\r\n# Type: bool, default:FALSE, \r\n# Min: , Max:\r\ndegree = FALSE  #default\r\nif (exists(\"settings_tsdecomp_params_degree\")) \r\n{\r\n\tdegree = settings_tsdecomp_params_degree\r\n}\r\n\r\n##PBI_PARAM: display_name: robustToOutliers, tooltip:robustToOutliers\r\n# Type: bool, default:TRUE, \r\n# Min: , Max:\r\nrobustToOutliers = TRUE  #default\r\nif (exists(\"settings_tsdecomp_params_robustToOutliers\")) \r\n{\r\n\trobustToOutliers = settings_tsdecomp_params_robustToOutliers\r\n}\r\n\r\n##PBI_PARAM: display_name: additive, tooltip:additive\r\n# Type: bool, default:TRUE, \r\n# Min: , Max:\r\nadditive = TRUE  #default\r\nif (exists(\"settings_tsdecomp_params_additive\")) \r\n{\r\n\tadditive = settings_tsdecomp_params_additive\r\n}\r\n\r\n##PBI_PARAM: display_name: trendSmoothness, tooltip:trendSmoothness\r\n# Type: numeric, default:10, \r\n# Min: 0, Max:100\r\ntrendSmoothness = 10  #default\r\nif (exists(\"settings_tsdecomp_params_trendSmoothness\")) \r\n{\r\n\ttrendSmoothness = settings_tsdecomp_params_trendSmoothness\r\n\ttrendSmoothness = max( min (trendSmoothness, 100), 0)\r\n}\r\n\r\n##PBI_PARAM: display_name: drawWhat, tooltip:drawWhat\r\n# Type: enumeration, default:'', \r\n# Min: , Max:\r\n# enumeration options: all ,trend ,seasonalyAdjasted ,clean ,\r\ndrawWhat = ''  #default\r\nif (exists(\"settings_tsdecomp_params_drawWhat\")) \r\n{\r\n\tdrawWhat = settings_tsdecomp_params_drawWhat\r\n}\r\n\r\n \r\n{\r\n  ## Convert to time series\r\n  myts <- ts(Value[,1], start = min(Time), frequency= freq)\r\n  \r\n  ## Decompose the timeseries object using the Loess function \r\n  fit <- stl(myts, s.window=\"periodic\", robust = robustToOutliers, s.degree = degree)\r\n  \r\n  ## Plot the result\r\n  if(drawWhat == \"all\")\r\n    plot(fit, col=\"blue\", main = \"\", lwd = lineWidth)\r\n  \r\n  clean = fit$time.series[,1]+fit$time.series[,2]\r\n  fit$time.series = cbind(fit$time.series, clean = clean)\r\n  \r\n  if(drawWhat != \"all\")\r\n  {\r\n    plot(myts, col=\"gray\",\r\n       main=\"\",\r\n       ylab=names(Value)[1], xlab=\"\", lwd = lineWidth/2)\r\n    \r\n    lines(fit$time.series[,drawWhat],col=\"red\",ylab = drawWhat, lwd = lineWidth)\r\n    #TODO: legend\r\n  }\r\n  \r\n}\r\n\r\nTimeSeriesDecomposition(Time,Value)\r\n"}}}],"objects":{"settings_tsdecomp_params":{"displayName":"tsdecomp settings","properties":{"show":{"type":{"bool":true}},"freq":{"displayName":"frequency","description":"frequency","type":{"numeric":true}},"degree":{"displayName":"degree","description":"degree","type":{"bool":true}},"robustToOutliers":{"displayName":"robustToOutliers","description":"robustToOutliers","type":{"bool":true}},"additive":{"displayName":"additive","description":"additive","type":{"bool":true}},"trendSmoothness":{"displayName":"trendSmoothness","description":"trendSmoothness","type":{"numeric":true}},"drawWhat":{"displayName":"drawWhat","description":"drawWhat","type":{"enumeration":[{"displayName":"all","value":"all"},{"displayName":"trend","value":"trend"},{"displayName":"seasonalyAdjasted","value":"seasonalyAdjasted"},{"displayName":"clean","value":"clean"}]}}}},"settings_demo_params":{"displayName":"tsdecomp demo settings","properties":{"show":{"type":{"bool":true}}}},"rcv_script":{"properties":{"provider":{"type":{"text":true}},"source":{"type":{"scripting":{"source":true}}}}}},"suppressDefaultTitle":true},"dependencies":{"cranPackages":[{"name":"car","displayName":"car: Companion to Applied Regression","url":"https://cran.r-project.org/web/packages/car/index.html"},{"name":"ggplot2","displayName":"ggplot2: An Implementation of the Grammar of Graphics","url":"https://cran.r-project.org/web/packages/ggplot2/index.html"}]},"content":{"js":"var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){function t(e,t,i,a){if(e){var s=e[t];if(s){var r=s[i];if(void 0!==r)return r}}return a}function i(e,t,i,a,s,r){if(e){var n=e[t];if(n){var o=n[i];if(o<s)return s;if(o>r)return r;if(void 0!==o)return o}}return a}function a(e,t,i,a,s,r){if(e){var n=e[t];if(n){var o=n[i];if(void 0!==o)return o>r?r:o<s?s:o}}return a}function s(e,t,i,a,s,r){return r&&t==i&&1==s?a:r&&t!=i&&0==s?a:e}function r(e,t){return\"auto\"!=t?\"None\":\"auto\"==t&&\"None\"==e?\"fast\":e}function n(e,t,i){return e<t?t:e>i?i:e}function o(e,t,i,a,s){var r=e.objects;if(r){var n=r[t];if(n){var o=n[i];if(o){var m=o[a];if(void 0!==m)return m}}}return s}function m(e,t,i,a){if(e){var s=e[t];if(s){var r=s[i];if(void 0!==r&&void 0!==r.solid&&void 0!==r.solid.color)return r.solid.color}}return a}e.getValue=t,e.getValueMinMax=i,e.getValueNumberMinMax=a,e.ifStringReturnString=s,e.ifStringReturnStringClustersMethod=r,e.inMinMax=n,e.getCategoricalObjectValue=o,e.getFillValue=m}(t=e.PBI_CV_Template||(e.PBI_CV_Template={}))}(t=e.visual||(e.visual={}))}(t=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(e){var t;!function(e){var t;!function(e){var t=function(){function t(e){this.imageDiv=document.createElement(\"div\"),this.imageDiv.className=\"rcv_autoScaleImageContainer\",e.element.appendChild(this.imageDiv),this.imageElement=document.createElement(\"img\"),this.imageElement.className=\"rcv_autoScaleImage\",this.imageDiv.appendChild(this.imageElement),this.settings_tsdecomp_params={show:!0,freq:12,degree:!1,robustToOutliers:!0,additive:!0,trendSmoothness:10,drawWhat:\"\"},this.settings_demo_params={show:!0}}return t.prototype.update=function(t){var i=t.dataViews;if(i&&0!==i.length){var a=i[0];if(a&&a.metadata){this.settings_tsdecomp_params={show:e.getValue(a.metadata.objects,\"settings_tsdecomp_params\",\"show\",!0),freq:e.getValue(a.metadata.objects,\"settings_tsdecomp_params\",\"freq\",12),degree:e.getValue(a.metadata.objects,\"settings_tsdecomp_params\",\"degree\",!1),robustToOutliers:e.getValue(a.metadata.objects,\"settings_tsdecomp_params\",\"robustToOutliers\",!0),additive:e.getValue(a.metadata.objects,\"settings_tsdecomp_params\",\"additive\",!0),trendSmoothness:e.getValue(a.metadata.objects,\"settings_tsdecomp_params\",\"trendSmoothness\",10),drawWhat:e.getValue(a.metadata.objects,\"settings_tsdecomp_params\",\"drawWhat\",\"\")},this.settings_demo_params={show:e.getValue(a.metadata.objects,\"settings_demo_params\",\"show\",!0)};var s=null;a.scriptResult&&a.scriptResult.payloadBase64&&(s=\"data:image/png;base64,\"+a.scriptResult.payloadBase64),s?this.imageElement.src=s:this.imageElement.src=null,this.onResizing(t.viewport)}}},t.prototype.onResizing=function(e){this.imageDiv.style.height=e.height+\"px\",this.imageDiv.style.width=e.width+\"px\"},t.prototype.enumerateObjectInstances=function(t){var i=t.objectName,a=[];switch(i){case\"settings_tsdecomp_params\":a.push({objectName:i,properties:{show:this.settings_tsdecomp_params.show,freq:e.inMinMax(this.settings_tsdecomp_params.freq,2,1e4),degree:this.settings_tsdecomp_params.degree,robustToOutliers:this.settings_tsdecomp_params.robustToOutliers,additive:this.settings_tsdecomp_params.additive,trendSmoothness:e.inMinMax(this.settings_tsdecomp_params.trendSmoothness,0,100),drawWhat:this.settings_tsdecomp_params.drawWhat},selector:null});break;case\"settings_demo_params\":a.push({objectName:i,properties:{show:this.settings_demo_params.show},selector:null})}return a},t}();e.Visual=t}(t=e.PBI_CV_Template||(e.PBI_CV_Template={}))}(t=e.visual||(e.visual={}))}(t=e.extensibility||(e.extensibility={}))}(powerbi||(powerbi={}));var powerbi;!function(e){var t;!function(t){var i;!function(t){t.PBI_CV_Template={name:\"PBI_CV_Template\",displayName:\"Template\",class:\"Visual\",version:\"1.0.0\",apiVersion:\"1.3.0\",create:function(t){return new e.extensibility.visual.PBI_CV_Template.Visual(t)},custom:!0}}(i=t.plugins||(t.plugins={}))}(t=e.visuals||(e.visuals={}))}(powerbi||(powerbi={}));","css":".visual-PBI_CV_Template .rcv_autoScaleImageContainer{position:relative}.visual-PBI_CV_Template .rcv_autoScaleImageContainer .rcv_autoScaleImage{max-width:100%;max-height:100%;position:absolute;top:50%;left:50%;transform:translateY(-50%) translateX(-50%);-webkit-transform:translateY(-50%) translateX(-50%)}","iconBase64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAAb0lEQVQ4jWNkYGDonTiFgSzARJ42CGCBUMX5OSRpgziWGjYzMDD8J04DIxKbIpup5GxGVIn/OMSpZvNg0CzLww4nSdMsy8P++MtPBgYGCEmaZpL0oGsmDwyGFIYG8CQsFDVklyQMDAwMyiqq5GkEAMytEf/ahckCAAAAAElFTkSuQmCC"}}